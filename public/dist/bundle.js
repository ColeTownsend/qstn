!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){c.route={mode:"pathname"}},{}],2:[function(a,b){b.exports={index:a("./index/index.ls"),show:a("./show/index.ls")}},{"./index/index.ls":4,"./show/index.ls":8}],3:[function(a,b){var c,d,e,f,g,h;c=a("mithril"),d=a("./model.ls"),e=a("../../stores/entry.ls"),f=a("../../models/entry.ls"),g=a("../../utils/app.ls"),h=b.exports=function(){g.title("Create and share polls and get live results"),this.froze=d.froze,this.entry=new f(d.entry)},h.prototype.filled=function(){var a,b,c,d,e,f,g;for(a=0,b=this.entry.options.length,c=0,e=(d=this.entry.options).length;e>c;++c)f=c,g=d[c],""!==g.option().trim()&&a++;return a},h.prototype.frozen=function(){this.froze=""===this.entry.question().trim()||this.filled()<2},h.prototype.watch=function(){var a,b;switch(a=this.filled(),b=this.entry.options.length,!0){case a+2===b&&2!==b:this.entry.pop();break;case a===b:this.entry.push()}this.frozen.call(this)},h.prototype.ship=function(a){var b,d,f,g,h;a.preventDefault(),d={};for(f in g=this.entry)h=g[f],d[f]=h;b=d,b.options.pop(),e.post(b).then(function(a){c.route("/q/"+a.slug)})}},{"../../models/entry.ls":18,"../../stores/entry.ls":19,"../../utils/app.ls":21,"./model.ls":5,mithril:26}],4:[function(a,b){var c,d;c=a("../../layouts/chrome.ls"),d={controller:a("./controller.ls"),view:a("./view.ls")},b.exports=c(d)},{"../../layouts/chrome.ls":17,"./controller.ls":3,"./view.ls":6}],5:[function(a,b){b.exports={froze:!0,entry:{question:"",options:[{option:""},{option:""}]}}},{}],6:[function(a,b){var c;c=a("mithril"),b.exports=function(a){return c("form.create",{onsubmit:a.ship.bind(a)},c(".input.large",{contenteditable:!0,placeholder:"What would you like to ask?",oninput:function(b){a.entry.question(b.target.innerText)},onkeyup:a.frozen.bind(a)},a.entry.question()),c(".options",a.entry.options.map(function(b,d){return c(".input.option",{key:d,contenteditable:!0,placeholder:"Option "+(d+1),oninput:function(a){b.option(a.target.innerText)},onkeyup:a.watch.bind(a,b)},b.option())})),c("button",{disabled:a.froze},"Ask"))}},{mithril:26}],7:[function(a,b){var c,d,e,f,g,h,i,j,k;c=a("mithril"),d=a("./model.ls"),e=a("../../utils/sock.ls"),f=a("../../stores/entry.ls"),g=a("../../models/entry.ls"),h=a("../../utils/cookie.ls"),i=a("../../utils/error.ls"),j=a("../../utils/app.ls"),k=b.exports=function(){var a;a=c.route.param("id"),f.get(a).then(function(a){var b;return a?(j.title(a.question),this.entry=new g(a),b=h.get(a.slug),this.selected=b?Number(b):null,this.sock=new e,this.sock.listen(this.get.bind(this))):i.four()}.bind(this))},k.prototype.change=function(a){var b,d,e;c.startComputation(),b=this.entry.options,d=b[a].votes(),null!==this.selected&&(e=b[this.selected].votes(),b[this.selected].votes(--e)),this.selected=a,b[a].votes(++d),c.endComputation(),this.sock.send(this.entry)},k.prototype.perc=function(a){var b,c,d,e,f;for(b=0,c=0,e=(d=this.entry.options).length;e>c;++c)f=d[c],b+=f.votes();return b=a.votes()/b*100,(b||(b=0)).toFixed(0)},k.prototype.get=function(a){var b,d,e,f,g,i;for(h.set(this.entry.slug,this.selected),c.startComputation(),b=this.entry.options,d=0,f=(e=a.options).length;f>d;++d)g=d,i=e[d],b[g].votes(i.votes);c.endComputation()},k.prototype.onunload=function(){var a;return null!=(a=this.sock)?a.kill():void 0}},{"../../models/entry.ls":18,"../../stores/entry.ls":19,"../../utils/app.ls":21,"../../utils/cookie.ls":22,"../../utils/error.ls":23,"../../utils/sock.ls":25,"./model.ls":9,mithril:26}],8:[function(a,b,c){arguments[4][4][0].apply(c,arguments)},{"../../layouts/chrome.ls":17,"./controller.ls":7,"./view.ls":10,dup:4}],9:[function(a,b){b.exports={}},{}],10:[function(a,b){var c,d;c=a("mithril"),d=a("../../utils/facebook.ls"),b.exports=function(a){return c(".show",c("header",c("h1",a.entry.question())),c(".options",a.entry.options.map(function(b,d){return c(".option",c(".radio",c("input",{type:"radio",checked:a.selected===d,onchange:a.change.bind(a,d),name:"option",value:d,id:"o-"+d}),c("label",{"for":"o-"+d})),c("label.label",{"for":"o-"+d},b.option()),c(".perc",""+a.perc(b)+"%"),c(".votes",b.votes()),c(".bar",c(".pro",{style:{width:""+a.perc(b)+"%"}})))})),c(".social",c("p","Share on ",c("a.twitter",{href:"//twitter.com/intent/tweet?text="+a.entry.question()+"+http://qstn.co"+a.entry.perma()},"Twitter")," or ",c("a.facebook",{href:"//facebook.com/sharer/sharer.php?u=http://qstn.co"+a.entry.perma(),onclick:d.sharer},"Facebook")),c("input",{readonly:!0,value:"qstn.co"+a.entry.perma(),onclick:function(a){return a.target.select()}})))}},{"../../utils/facebook.ls":24,mithril:26}],11:[function(a,b){var c,d,e;c=a("mithril"),d=a("./model.ls"),e=b.exports=function(){}},{"./model.ls":13,mithril:26}],12:[function(a,b){var c;c={controller:a("./controller.ls"),view:a("./view.ls")},b.exports=c},{"./controller.ls":11,"./view.ls":14}],13:[function(a,b,c){arguments[4][9][0].apply(c,arguments)},{dup:9}],14:[function(a,b){var c;c=a("mithril"),b.exports=function(){return c(".error",c("a",{href:"//youtube.com/watch?v=3WSe9ugpXIw"},"404"))}},{mithril:26}],15:[function(a,b){b.exports={four:a("./four/index.ls")}},{"./four/index.ls":12}],16:[function(a){var b,c,d,e;b=a("mithril"),c=a("./config.ls"),d=a("./entries/index.ls"),e=a("./errors/index.ls"),b.route.mode=c.route.mode,b.route(document.body,"/",{"/":d.index,"/q/:id":d.show,"/:e...":e.four})},{"./config.ls":1,"./entries/index.ls":2,"./errors/index.ls":15,mithril:26}],17:[function(a,b){var c,d;c=a("mithril"),d={},d.controller=function(a){var b;b=new a.controller,this.content=a.view.bind(this,b),this.onunload=function(){"function"==typeof b.onunload&&b.onunload()}},d.view=function(a){return c("div",c("header.site-header",c(".content",c("h1.logo",c("a",{config:c.route,href:"/"},"qstn")),c("h5.motto","Create and share polls and get live results"))),c("main.site-main",c(".content",a.content())),c("footer.site-footer",c(".content",c("span","Â© 2015 qstn ~ ",c("a",{href:"//github.com/daryl/qstn"},"source")))))},b.exports=function(a){return{controller:function(){return new d.controller(a)},view:d.view}}},{mithril:26}],18:[function(a,b){var c,d,e;c=a("mithril"),d=function(a){this.option=c.prop(a.option)||"",this.votes=c.prop(a.votes)||0},e=function(a){this.slug=a.slug,this.question=c.prop(a.question),this.options=a.options.map(function(a){return new d(a)})},e.prototype.perma=function(){return"/q/"+this.slug},e.prototype.push=function(){this.options.push(new d({option:""}))},e.prototype.pop=function(){this.options.pop()},b.exports=e},{mithril:26}],19:[function(a,b){var c,d,e;c=a("mithril"),d=a("../utils/ajax.ls"),e={},e.get=function(a){return d({url:"/q/"+a,method:"GET"})},e.post=function(a){return d({url:"/q/",method:"POST",data:a})},b.exports=e},{"../utils/ajax.ls":20,mithril:26}],20:[function(a,b){var c,d,e,f;c=a("mithril"),d=function(a){a.setRequestHeader("X-Requested-With","XMLHttpRequest")},e=function(){document.body.setAttribute("loading","")},f=function(a){return document.body.removeAttribute("loading"),a},b.exports=function(a){return e(),a.config=d,c.request(a).then(f,f)}},{mithril:26}],21:[function(a,b,c){var d,e="".split;d=a("mithril"),c.title=function(a){var b;b=e.call(document.title," | "),document.title=document.title.replace(b[0],a)}},{mithril:26}],22:[function(a,b,c){var d="".split;c.get=function(a){var b,c,e,f,g;for(a+="=",b=d.call(document.cookie,";"),c=0,e=b.length;e>c;++c){for(f=c,g=b[c];" "===g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(a))return g.substring(a.length,g.length)}return null},c.set=function(a,b,c){c=c?+new Date+c:null,c=c?";expires="+c:"",document.cookie=a+"="+b+c+";path=/"}},{}],23:[function(a,b,c){var d,e;d=a("mithril"),e=a("../errors/index.ls"),c.four=function(){d.module(document.body,e.four)}},{"../errors/index.ls":15,mithril:26}],24:[function(a,b,c){var d;d=a("../config.ls"),c.sharer=function(a){var b,c;return b=window.innerWidth/2-250,c=window.innerHeight/2-100,window.open(a.target.href,"fb","width=500,height=300,top="+c+",left="+b+",toolbar=0,scrollbars=1,statusbar=0,menubar=0"),!1}},{"../config.ls":1}],25:[function(a,b){var c,d,e="".split;c=a("../config.ls"),d=b.exports=function(){this.fnc=[],setTimeout(function(){var a;return a=e.call(location.pathname,"/"),this.s=new WebSocket("ws:"+location.host+"/s/"+a[2]),this.bind()}.bind(this),0)},d.prototype.bind=function(){this.s.onmessage=function(a){var b,c,d,e,f,g=[];if("PING"!==a.data){for(b=JSON.parse(a.data),c=0,e=(d=this.fnc).length;e>c;++c)f=d[c],g.push(f(b));return g}}.bind(this)},d.prototype.send=function(a){this.s.send(JSON.stringify(a))},d.prototype.listen=function(a){this.fnc.push(a)},d.prototype.kill=function(){this.s.close()}},{"../config.ls":1}],26:[function(a,b){var c=function d(a,b){function c(a){D=a.document,E=a.location,G=a.cancelAnimationFrame||a.clearTimeout,F=a.requestAnimationFrame||a.setTimeout}function e(){var a,b=[].slice.call(arguments),c=!(null==b[1]||L.call(b[1])!==H||"tag"in b[1]||"subtree"in b[1]),d=c?b[1]:{},e="class"in d?"class":"className",f={tag:"div",attrs:{}},g=[];if(L.call(b[0])!=J)throw new Error("selector in m(selector, attrs, children) should be a string");for(;a=M.exec(b[0]);)if(""===a[1]&&a[2])f.tag=a[2];else if("#"===a[1])f.attrs.id=a[2];else if("."===a[1])g.push(a[2]);else if("["===a[3][0]){var h=N.exec(a[3]);f.attrs[h[1]]=h[3]||(h[2]?"":!0)}g.length>0&&(f.attrs[e]=g.join(" "));var i=c?b[2]:b[1];f.children=L.call(i)===I?i:b.slice(c?2:1);for(var j in d)f.attrs[j]=j===e?(f.attrs[j]||"")+" "+d[j]:d[j];return f}function f(a,c,d,e,j,l,m,n,o,p,q){if((null==j||null==j.toString())&&(j=""),"retain"===j.subtree)return l;var r=L.call(l),s=L.call(j);if(null==l||r!==s){if(null!=l)if(d&&d.nodes){var t=n-e,u=t+(s===I?j:l.nodes).length;i(d.nodes.slice(t,u),d.slice(t,u))}else l.nodes&&i(l.nodes,l);l=new j.constructor,l.tag&&(l={}),l.nodes=[]}if(s===I){for(var v=0,w=j.length;w>v;v++)L.call(j[v])===I&&(j=j.concat.apply([],j),v--);for(var x=[],y=l.length===j.length,z=0,A=1,B=2,C=3,E={},F=[],G=!1,v=0;v<l.length;v++)l[v]&&l[v].attrs&&null!=l[v].attrs.key&&(G=!0,E[l[v].attrs.key]={action:A,index:v});if(G){j.indexOf(null)>-1&&(j=j.filter(function(a){return null!=a}));var M=!1;if(j.length!=l.length)M=!0;else for(var N,P,v=0;N=l[v],P=j[v];v++)if(N.attrs&&P.attrs&&N.attrs.key!=P.attrs.key){M=!0;break}if(M){for(var v=0,w=j.length;w>v;v++)if(j[v]&&j[v].attrs)if(null!=j[v].attrs.key){var Q=j[v].attrs.key;E[Q]=E[Q]?{action:C,index:v,from:E[Q].index,element:a.childNodes[E[Q].index]||D.createElement("div")}:{action:B,index:v}}else F.push({index:v,element:a.childNodes[v]||D.createElement("div")});var R=[];for(var S in E)R.push(E[S]);for(var T,U=R.sort(g),V=new Array(l.length),v=0;T=U[v];v++){if(T.action===A&&(i(l[T.index].nodes,l[T.index]),V.splice(T.index,1)),T.action===B){var W=D.createElement("div");W.key=j[T.index].attrs.key,a.insertBefore(W,a.childNodes[T.index]||null),V.splice(T.index,0,{attrs:{key:j[T.index].attrs.key},nodes:[W]})}T.action===C&&(a.childNodes[T.index]!==T.element&&null!==T.element&&a.insertBefore(T.element,a.childNodes[T.index]||null),V[T.index]=l[T.from])}for(var v=0,w=F.length;w>v;v++){var T=F[v];a.insertBefore(T.element,a.childNodes[T.index]||null),V[T.index]=l[T.index]}l=V,l.nodes=new Array(a.childNodes.length);for(var X,v=0;X=a.childNodes[v];v++)l.nodes[v]=X}}for(var v=0,Y=0,w=j.length;w>v;v++){var Z=f(a,c,l,n,j[v],l[Y],m,n+z||z,o,p,q);Z!==b&&(Z.nodes.intact||(y=!1),z+=Z.$trusted?(Z.match(/<[^\/]|\>\s*[^<]/g)||[]).length:L.call(Z)===I?Z.length:1,l[Y++]=Z)}if(!y){for(var v=0,w=j.length;w>v;v++)null!=l[v]&&x.push.apply(x,l[v].nodes);for(var $,v=0;$=l.nodes[v];v++)null!=$.parentNode&&x.indexOf($)<0&&i([$],[l[v]]);j.length<l.length&&(l.length=j.length),l.nodes=x}}else if(null!=j&&s===H){j.attrs||(j.attrs={}),l.attrs||(l.attrs={});var _=Object.keys(j.attrs),ab=_.length>("key"in j.attrs?1:0);if((j.tag!=l.tag||_.join()!=Object.keys(l.attrs).join()||j.attrs.id!=l.attrs.id)&&(l.nodes.length&&i(l.nodes),l.configContext&&typeof l.configContext.onunload===K&&l.configContext.onunload()),L.call(j.tag)!=J)return;var $,bb=0===l.nodes.length;if(j.attrs.xmlns?p=j.attrs.xmlns:"svg"===j.tag?p="http://www.w3.org/2000/svg":"math"===j.tag&&(p="http://www.w3.org/1998/Math/MathML"),bb?($=j.attrs.is?p===b?D.createElement(j.tag,j.attrs.is):D.createElementNS(p,j.tag,j.attrs.is):p===b?D.createElement(j.tag):D.createElementNS(p,j.tag),l={tag:j.tag,attrs:ab?h($,j.tag,j.attrs,{},p):j.attrs,children:null!=j.children&&j.children.length>0?f($,j.tag,b,b,j.children,l.children,!0,0,j.attrs.contenteditable?$:o,p,q):j.children,nodes:[$]},l.children&&!l.children.nodes&&(l.children.nodes=[]),"select"===j.tag&&j.attrs.value&&h($,j.tag,{value:j.attrs.value},{},p),a.insertBefore($,a.childNodes[n]||null)):($=l.nodes[0],ab&&h($,j.tag,j.attrs,l.attrs,p),l.children=f($,j.tag,b,b,j.children,l.children,!1,0,j.attrs.contenteditable?$:o,p,q),l.nodes.intact=!0,m===!0&&null!=$&&a.insertBefore($,a.childNodes[n]||null)),typeof j.attrs.config===K){var cb=l.configContext=l.configContext||{},db=function(a,b){return function(){return a.attrs.config.apply(a,b)}};q.push(db(j,[$,!bb,cb,l]))}}else if(typeof s!=K){var x;0===l.nodes.length?(j.$trusted?x=k(a,n,j):(x=[D.createTextNode(j)],a.nodeName.match(O)||a.insertBefore(x[0],a.childNodes[n]||null)),l="string number boolean".indexOf(typeof j)>-1?new j.constructor(j):j,l.nodes=x):l.valueOf()!==j.valueOf()||m===!0?(x=l.nodes,o&&o===D.activeElement||(j.$trusted?(i(x,l),x=k(a,n,j)):"textarea"===c?a.value=j:o?o.innerHTML=j:((1===x[0].nodeType||x.length>1)&&(i(l.nodes,l),x=[D.createTextNode(j)]),a.insertBefore(x[0],a.childNodes[n]||null),x[0].nodeValue=j)),l=new j.constructor(j),l.nodes=x):l.nodes.intact=!0}return l}function g(a,b){return a.action-b.action||a.index-b.index}function h(a,b,c,d,e){for(var f in c){var g=c[f],h=d[f];if(f in d&&h===g)"value"===f&&"input"===b&&a.value!=g&&(a.value=g);else{d[f]=g;try{if("config"===f||"key"==f)continue;if(typeof g===K&&0===f.indexOf("on"))a[f]=l(g,a);else if("style"===f&&null!=g&&L.call(g)===H){for(var i in g)(null==h||h[i]!==g[i])&&(a.style[i]=g[i]);for(var i in h)i in g||(a.style[i]="")}else null!=e?"href"===f?a.setAttributeNS("http://www.w3.org/1999/xlink","href",g):"className"===f?a.setAttribute("class",g):a.setAttribute(f,g):f in a&&"list"!==f&&"style"!==f&&"form"!==f&&"type"!==f?("input"!==b||a[f]!==g)&&(a[f]=g):a.setAttribute(f,g)}catch(j){if(j.message.indexOf("Invalid argument")<0)throw j}}}return d}function i(a,b){for(var c=a.length-1;c>-1;c--)if(a[c]&&a[c].parentNode){try{a[c].parentNode.removeChild(a[c])}catch(d){}b=[].concat(b),b[c]&&j(b[c])}0!=a.length&&(a.length=0)}function j(a){if(a.configContext&&typeof a.configContext.onunload===K&&a.configContext.onunload(),a.children)if(L.call(a.children)===I)for(var b,c=0;b=a.children[c];c++)j(b);else a.children.tag&&j(a.children)}function k(a,b,c){var d=a.childNodes[b];if(d){var e=1!=d.nodeType,f=D.createElement("span");e?(a.insertBefore(f,d||null),f.insertAdjacentHTML("beforebegin",c),a.removeChild(f)):d.insertAdjacentHTML("beforebegin",c)}else a.insertAdjacentHTML("beforeend",c);for(var g=[];a.childNodes[b]!==d;)g.push(a.childNodes[b]),b++;return g}function l(a,b){return function(c){c=c||event,e.redraw.strategy("diff"),e.startComputation();try{return a.call(b,c)}finally{ab()}}}function m(a){var b=R.indexOf(a);return 0>b?R.push(a)-1:b}function n(a){var b=function(){return arguments.length&&(a=arguments[0]),a};return b.toJSON=function(){return a},b}function o(){for(var a,b="all"===e.redraw.strategy(),c=0;a=U[c];c++)W[c]&&e.render(a,V[c].view(W[c]),b);Z&&(Z(),Z=null),X=null,Y=new Date,e.redraw.strategy("diff")}function p(a){return a.slice(db[e.route.mode].length)}function q(a,b,c){bb={};var d=c.indexOf("?");-1!==d&&(bb=u(c.substr(d+1,c.length)),c=c.substr(0,d));for(var f in b){if(f===c)return e.module(a,b[f]),!0;var g=new RegExp("^"+f.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(g.test(c))return c.replace(g,function(){for(var c=f.match(/:[^\/]+/g)||[],d=[].slice.call(arguments,1,-2),g=0,h=c.length;h>g;g++)bb[c[g].replace(/:|\./g,"")]=decodeURIComponent(d[g]);e.module(a,b[f])}),!0}}function r(a){if(a=a||event,!a.ctrlKey&&!a.metaKey&&2!==a.which){a.preventDefault?a.preventDefault():a.returnValue=!1;var b=a.currentTarget||this,c="pathname"===e.route.mode&&b.search?u(b.search.slice(1)):{};e.route(b[e.route.mode].slice(db[e.route.mode].length),c)}}function s(){"hash"!=e.route.mode&&E.hash?E.hash=E.hash:a.scrollTo(0,0)}function t(a,b){var c=[];for(var d in a){var e=b?b+"["+d+"]":d,f=a[d];c.push(null!=f&&L.call(f)===H?t(f,e):encodeURIComponent(e)+"="+encodeURIComponent(f))}return c.join("&")}function u(a){for(var b=a.split("&"),c={},d=0,e=b.length;e>d;d++){var f=b[d].split("=");c[v(f[0])]=f[1]?v(f[1]):""}return c}function v(a){return decodeURIComponent(a.replace(/\+/g," "))}function w(a){var c=m(a);i(a.childNodes,S[c]),S[c]=b}function x(a){var b=e.prop();return a.then(b),b.then=function(b,c){return x(a.then(b,c))},b}function y(a,b){function c(a){l=a||j,n.map(function(a){l===i&&a.resolve(m)||a.reject(m)})}function d(a,b,c,d){if((null!=m&&L.call(m)===H||typeof m===K)&&typeof a===K)try{var f=0;a.call(m,function(a){f++||(m=a,b())},function(a){f++||(m=a,c())})}catch(g){e.deferred.onerror(g),m=g,c()}else d()}function f(){var j;try{j=m&&m.then}catch(n){return e.deferred.onerror(n),m=n,l=h,f()}d(j,function(){l=g,f()},function(){l=h,f()},function(){try{l===g&&typeof a===K?m=a(m):l===h&&"function"==typeof b&&(m=b(m),l=g)}catch(f){return e.deferred.onerror(f),m=f,c()}m===k?(m=TypeError(),c()):d(j,function(){c(i)},c,function(){c(l===g&&i)})})}var g=1,h=2,i=3,j=4,k=this,l=0,m=0,n=[];k.promise={},k.resolve=function(a){return l||(m=a,l=g,f()),this},k.reject=function(a){return l||(m=a,l=h,f()),this},k.promise.then=function(a,b){var c=new y(a,b);return l===i?c.resolve(m):l===j?c.reject(m):n.push(c),c.promise}}function z(a){return a}function A(c){if(!c.dataType||"jsonp"!==c.dataType.toLowerCase()){var d=new a.XMLHttpRequest;if(d.open(c.method,c.url,!0,c.user,c.password),d.onreadystatechange=function(){4===d.readyState&&(d.status>=200&&d.status<300?c.onload({type:"load",target:d}):c.onerror({type:"error",target:d}))},c.serialize===JSON.stringify&&c.data&&"GET"!==c.method&&d.setRequestHeader("Content-Type","application/json; charset=utf-8"),c.deserialize===JSON.parse&&d.setRequestHeader("Accept","application/json, text/*"),typeof c.config===K){var e=c.config(d,c);null!=e&&(d=e)}var f="GET"!==c.method&&c.data?c.data:"";if(f&&L.call(f)!=J&&f.constructor!=a.FormData)throw"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`";return d.send(f),d}var g="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),h=D.createElement("script");a[g]=function(d){D.body.removeChild(h),c.onload({type:"load",target:{responseText:d}}),a[g]=b},h.onerror=function(){return D.body.removeChild(h),c.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),a[g]=b,!1},h.onload=function(){return!1},h.src=c.url+(c.url.indexOf("?")>0?"&":"?")+(c.callbackKey?c.callbackKey:"callback")+"="+g+"&"+t(c.data||{}),D.body.appendChild(h)}function B(a,b,c){if("GET"===a.method&&"jsonp"!=a.dataType){var d=a.url.indexOf("?")<0?"?":"&",e=t(b);a.url=a.url+(e?d+e:"")}else a.data=c(b);return a}function C(a,b){var c=a.match(/:[a-z]\w+/gi);if(c&&b)for(var d=0;d<c.length;d++){var e=c[d].slice(1);a=a.replace(c[d],b[e]),delete b[e]}return a}var D,E,F,G,H="[object Object]",I="[object Array]",J="[object String]",K="function",L={}.toString,M=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,N=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,O=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/;c(a);var P,Q={appendChild:function(a){P===b&&(P=D.createElement("html")),D.documentElement&&D.documentElement!==a?D.replaceChild(a,D.documentElement):D.appendChild(a),this.childNodes=D.childNodes},insertBefore:function(a){this.appendChild(a)},childNodes:[]},R=[],S={};e.render=function(a,c,d){var e=[];if(!a)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var g=m(a),h=a===D,j=h||a===D.documentElement?Q:a;h&&"html"!=c.tag&&(c={tag:"html",attrs:{},children:c}),S[g]===b&&i(j.childNodes),d===!0&&w(a),S[g]=f(j,null,b,b,c,S[g],!1,0,null,b,e);for(var k=0,l=e.length;l>k;k++)e[k]()},e.trust=function(a){return a=new String(a),a.$trusted=!0,a},e.prop=function(a){return(null!=a&&L.call(a)===H||typeof a===K)&&typeof a.then===K?x(a):n(a)};var T,U=[],V=[],W=[],X=null,Y=0,Z=null,$=16;e.module=function(a,b){if(!a)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var c=U.indexOf(a);0>c&&(c=U.length);var d=!1;if(W[c]&&typeof W[c].onunload===K){var f={preventDefault:function(){d=!0}};W[c].onunload(f)}if(!d){e.redraw.strategy("all"),e.startComputation(),U[c]=a;var g=T=b,h=new b.controller;return g===T&&(W[c]=h,V[c]=b),ab(),W[c]}},e.redraw=function(b){X&&b!==!0?(new Date-Y>$||F===a.requestAnimationFrame)&&(X>0&&G(X),X=F(o,$)):(o(),X=F(function(){X=null},$))},e.redraw.strategy=e.prop();var _=0;e.startComputation=function(){_++},e.endComputation=function(){_=Math.max(_-1,0),0===_&&e.redraw()};var ab=function(){"none"==e.redraw.strategy()?(_--,e.redraw.strategy("diff")):e.endComputation()};e.withAttr=function(a,b){return function(c){c=c||event;var d=c.currentTarget||this;b(a in d?d[a]:d.getAttribute(a))}};var bb,cb,db={pathname:"",hash:"#",search:"?"},eb=function(){};return e.route=function(){if(0===arguments.length)return cb;if(3===arguments.length&&L.call(arguments[1])===J){var b=arguments[0],c=arguments[1],d=arguments[2];eb=function(a){var f=cb=p(a);q(b,d,f)||e.route(c,!0)};var f="hash"===e.route.mode?"onhashchange":"onpopstate";a[f]=function(){cb!=p(E[e.route.mode])&&eb(E[e.route.mode])},Z=s,a[f]()}else if(arguments[0].addEventListener){{var g=arguments[0];arguments[1],arguments[2]}g.href=("pathname"!==e.route.mode?E.pathname:"")+db[e.route.mode]+this.attrs.href,g.removeEventListener("click",r),g.addEventListener("click",r)}else if(L.call(arguments[0])===J){cb=arguments[0];var h=arguments[1]||{},i=cb.indexOf("?"),j=i>-1?u(cb.slice(i+1)):{};for(var k in h)j[k]=h[k];var l=t(j),m=i>-1?cb.slice(0,i):cb;l&&(cb=m+(-1===m.indexOf("?")?"?":"&")+l);var n=(3===arguments.length?arguments[2]:arguments[1])===!0;a.history.pushState?(Z=function(){a.history[n?"replaceState":"pushState"](null,D.title,db[e.route.mode]+cb),s()},eb(db[e.route.mode]+cb)):E[e.route.mode]=cb}},e.route.param=function(a){if(!bb)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return bb[a]},e.route.mode="search",e.deferred=function(){var a=new y;return a.promise=x(a.promise),a},e.deferred.onerror=function(a){if("[object Error]"===L.call(a)&&!a.constructor.toString().match(/ Error/))throw a},e.sync=function(a){function b(a,b){return function(e){return g[a]=e,b||(c="reject"),0===--f&&(d.promise(g),d[c](g)),e}}var c="resolve",d=e.deferred(),f=a.length,g=new Array(f);if(a.length>0)for(var h=0;h<a.length;h++)a[h].then(b(h,!0),b(h,!1));else d.resolve([]);return d.promise},e.request=function(a){a.background!==!0&&e.startComputation();var b=e.deferred(),c=a.dataType&&"jsonp"===a.dataType.toLowerCase(),d=a.serialize=c?z:a.serialize||JSON.stringify,f=a.deserialize=c?z:a.deserialize||JSON.parse,g=a.extract||function(a){return 0===a.responseText.length&&f===JSON.parse?null:a.responseText};return a.url=C(a.url,a.data),a=B(a,a.data,d),a.onload=a.onerror=function(c){try{c=c||event;var d=("load"===c.type?a.unwrapSuccess:a.unwrapError)||z,h=d(f(g(c.target,a)));if("load"===c.type)if(L.call(h)===I&&a.type)for(var i=0;i<h.length;i++)h[i]=new a.type(h[i]);else a.type&&(h=new a.type(h));b["load"===c.type?"resolve":"reject"](h)}catch(c){e.deferred.onerror(c),b.reject(c)}a.background!==!0&&e.endComputation()},A(a),b.promise(a.initialValue),b.promise},e.deps=function(b){return c(a=b||a),a},e.deps.factory=d,e}("undefined"!=typeof window?window:{});"undefined"!=typeof b&&null!==b&&b.exports?b.exports=c:"function"==typeof define&&define.amd&&define(function(){return c})},{}]},{},[16]);